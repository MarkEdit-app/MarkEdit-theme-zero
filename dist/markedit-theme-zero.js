"use strict";const Q=require("@codemirror/state"),c=require("@lezer/highlight"),f=require("markedit-api"),W=require("@codemirror/view"),E=require("@codemirror/language"),y=(e,n={})=>e??n,X=y(f.MarkEdit.userSettings),w=N("extension.markeditTheming"),Y=v(!1)?y(w.lightTheme):void 0,Z=v(!0)?y(w.darkTheme):void 0;function N(e){return e===void 0?{}:y(X[e])}function O(e){return e.enabledMode??"both"}function v(e,n=O(w)){return["both",e?"dark":"light"].includes(n)}function tt(e,n,a){const r=et({lhs:a,rhs:e?Z:Y});return{extensions:[...e?L(r,{dark:!0}):L(r),n].filter(t=>t!==void 0),colors:r}}function L(e,n){const a={},r=[],o=e.editor,t=e.highlight;o?.textColor&&(a["&"]??={},a["&"].color=o?.textColor,a[".cm-activeLineGutter"]={backgroundColor:o?.textColor}),o?.backgroundColor&&(a["&"]??={},a["&"].backgroundColor=o?.backgroundColor),o?.activeLineBackground&&(a[".cm-activeLine"]={backgroundColor:o?.activeLineBackground}),o?.caretColor&&(a[".cm-content"]={caretColor:o?.caretColor},a[".cm-cursor, .cm-dropCursor"]={borderLeftColor:o?.caretColor}),o?.selectionBackground&&(a["&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection"]={backgroundColor:o?.selectionBackground}),o?.matchingBracketBackground&&(a["&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket"]={backgroundColor:o?.matchingBracketBackground}),o?.gutterText&&(a[".cm-gutters"]??={},a[".cm-gutters"].color=o?.gutterText),o?.gutterBackground&&(a[".cm-gutters"]??={},a[".cm-gutters"].backgroundColor=o?.gutterBackground,a[".cm-gutters"].border="none"),o?.foldPlaceholderText&&(a[".cm-foldPlaceholder"]??={},a[".cm-foldPlaceholder"].color=o?.foldPlaceholderText),o?.foldPlaceholderBackground&&(a[".cm-foldPlaceholder"]??={},a[".cm-foldPlaceholder"].backgroundColor=o?.foldPlaceholderBackground,a[".cm-foldPlaceholder"].border="none"),o?.searchMatchBackground&&(a[".cm-searchMatch"]={backgroundColor:o?.searchMatchBackground}),o?.selectionMatchBackground&&(a[".cm-selectionMatch"]={backgroundColor:o?.selectionMatchBackground}),t?.heading&&r.push({tag:c.tags.heading,color:t?.heading}),t?.bold&&r.push({tag:c.tags.strong,color:t?.bold}),t?.italic&&r.push({tag:c.tags.emphasis,color:t?.italic}),t?.strikethrough&&r.push({tag:c.tags.strikethrough,color:t?.strikethrough}),t?.quote&&r.push({tag:c.tags.quote,color:t?.quote}),t?.link&&r.push({tag:[c.tags.url,c.tags.link],color:t?.link}),t?.divider&&r.push({tag:c.tags.contentSeparator,color:t?.divider}),t?.comment&&r.push({tag:c.tags.comment,color:t?.comment}),t?.meta&&r.push({tag:c.tags.meta,color:t?.meta}),t?.keyword&&r.push({tag:c.tags.keyword,color:t?.keyword}),t?.atom&&r.push({tag:[c.tags.atom,c.tags.bool],color:t?.atom}),t?.literal&&r.push({tag:[c.tags.literal,c.tags.inserted],color:t?.literal}),t?.string&&r.push({tag:[c.tags.string,c.tags.deleted],color:t?.string}),t?.special&&r.push({tag:[c.tags.regexp,c.tags.escape,c.tags.special(c.tags.string)],color:t?.special}),t?.variable&&r.push({tag:c.tags.definition(c.tags.variableName),color:t?.variable}),t?.local&&r.push({tag:c.tags.local(c.tags.variableName),color:t?.local}),t?.type&&r.push({tag:[c.tags.typeName,c.tags.namespace],color:t?.type}),t?.class&&r.push({tag:c.tags.className,color:t?.class}),t?.macro&&r.push({tag:[c.tags.special(c.tags.variableName),c.tags.macroName],color:t?.macro}),t?.property&&r.push({tag:c.tags.definition(c.tags.propertyName),color:t?.property}),t?.label&&r.push({tag:c.tags.labelName,color:t?.label}),t?.operator&&r.push({tag:[c.tags.operator,c.tags.operatorKeyword],color:t?.operator}),t?.constant&&r.push({tag:[c.tags.color,c.tags.constant(c.tags.name),c.tags.standard(c.tags.name)],color:t?.constant}),t?.instruction&&r.push({tag:[c.tags.separator,c.tags.processingInstruction,c.tags.definition(c.tags.name)],color:t?.instruction}),t?.invalid&&r.push({tag:c.tags.invalid,color:t?.invalid});const l=[];return Object.keys(a).length>0&&l.push(W.EditorView.theme(a,n)),r.length>0&&l.push(E.syntaxHighlighting(E.HighlightStyle.define(r))),l}function et(e){return{editor:{...e.lhs?.editor,...e.rhs?.editor},highlight:{...e.lhs?.highlight,...e.rhs?.highlight},allowsFallback:e.rhs?.allowsFallback??e.lhs?.allowsFallback}}const i={selectionBackground:".cm-selectionBackground",lineGutter:".cm-lineNumbers > .cm-activeLineGutter",foldGutter:".cm-foldGutter, .cm-foldPlaceholder",visibleSpace:".cm-visibleSpace, .cm-visibleSpace::before, .cm-visibleLineBreak, .cm-visibleLineBreak::before",matchingBracket:".cm-matchingBracket",activeIndicator:".cm-md-activeIndicator",accentColor:".cm-md-header:not(.tok-meta):not(.cm-md-quote), .cm-md-codeInfo",syntaxMarker:".cm-md-header.tok-meta:not(.cm-md-quote), .cm-md-codeMark, .cm-md-linkMark, .cm-md-listMark, .cm-md-quoteMark, .cm-md-bold.tok-meta, .cm-md-italic.tok-meta, .cm-md-strikethrough.tok-meta",boldText:".cm-md-bold:not(.tok-meta)",italicText:".cm-md-italic:not(.tok-meta)",quoteText:".cm-md-quote:not(.cm-md-quoteMark)",dividerColor:".cm-md-horizontalRule"},ot=`
.cm-activeLineGutter { background: inherit !important }
.cm-searchMatch.cm-searchMatch-selected { outline: inherit !important }
${i.lineGutter} {}
${i.foldGutter} {}
${i.visibleSpace} {}
${i.matchingBracket} {}
${i.activeIndicator} {}
${i.accentColor} {}
${i.syntaxMarker} {}
${i.boldText} {}
${i.italicText} {}
${i.quoteText} {}
${i.dividerColor} {}
`,j=window,rt=j.__extractStyleRules__??(e=>e.value?.rules),ct=j.__extractHighlightSpecs__??(e=>e.value?.specs);function at(e){const n=document.createElement("style");return n.textContent=e,document.head.appendChild(n),n}function nt(e){if(e.length===0)return[{},[]];const n=M(e);return[Object.fromEntries(n.flatMap(r=>{const o=rt(r)?.join(`
`)??"";return Object.entries(st(o))})),n.flatMap(r=>ct(r)??[])]}function h(e,n,a){return e.find(r=>!!(r.tag.toString().includes(n.toString())&&r.color!==void 0))?.color??a}function B(e,n,a){for(const[r,o]of Object.entries(e))if(r.includes(n)&&(a===void 0||!r.includes(a))){const t=o.background??o.backgroundColor;if(t!==void 0)return t}}function it(e){const n=e.match(/rgba?\((\d+), (\d+), (\d+)(?:, ([\d.]+))?\)/);if(n===null)return;const[a,r,o]=n.slice(1,4).map(Number);return`rgba(${a}, ${r}, ${o}, 0.6)`}function R(e){const n=o=>o!==null&&typeof o=="object";if(!n(e))return!0;const a=Object.entries(e),r=o=>o!=null;for(const[,o]of a)if(n(o)){if(!R(o))return!1}else if(r(o))return!1;return!0}function M(e){return Array.isArray(e)?e.flatMap(M):"extension"in e?M(e.extension):[e]}function st(e){const n={},a=new CSSStyleSheet;a.replaceSync(e);for(const r of a.cssRules){const{style:o,selectorText:t}=r,{background:l,backgroundColor:u}=o;n[t]={},l.length>0&&(n[t].background=l),u.length>0&&(n[t].backgroundColor=u)}return n}function lt(e){const n=e.options?.settingsKey,a=O(N(n));e.light!==void 0&&v(!1,a)&&(s().customThemes.light=e.light),e.dark!==void 0&&v(!0,a)&&(s().customThemes.dark=e.dark),typeof f.MarkEdit.editorView=="object"&&S(f.MarkEdit.editorView)}const b=window,s=()=>b.__markeditTheming__,G=matchMedia("(prefers-color-scheme: dark)");typeof s()!="object"&&dt();function dt(){b.__markeditTheming__={styleSheet:at(ot),configurator:new Q.Compartment,customThemes:{},lightOriginalRules:{},darkOriginalRules:{}},f.MarkEdit.addExtension(s().configurator.of([])),f.MarkEdit.onEditorReady(n=>S(n));const e=()=>setTimeout(()=>S(f.MarkEdit.editorView),15);G.addEventListener("change",e),s().mainThemeName=b.config.theme,Object.defineProperty(b.config,"theme",{get(){return s().mainThemeName},set(n){s().mainThemeName=n,e()}})}function S(e){const n=G.matches,a=n?s().customThemes.dark:s().customThemes.light,{extensions:r,colors:o}=tt(n,a?.extension,a?.colors);e.dispatch({effects:s().configurator.reconfigure(r)});const[t,l]=nt(r),u=r.length===0&&R(o),k=o.allowsFallback??a?.extension!==void 0;s().styleSheet.disabled=u,ut(e,n,u,t,l,o,k)}function ut(e,n,a,r,o,t,l){const u=B(r,".cm-activeLine",".cm-activeLineGutter"),k=B(r,i.selectionBackground),F=B(r,i.matchingBracket),C=getComputedStyle(e.contentDOM).color,q=t.editor?.visibleSpaceColor??it(C),m=l?C:void 0,$=h(o,c.tags.heading,m),I=h(o,c.tags.processingInstruction,m),V=h(o,c.tags.strong,m),H=h(o,c.tags.emphasis,m),A=h(o,c.tags.quote,m),K=h(o,c.tags.contentSeparator,m),U=[[i.activeIndicator,u,"background"],[i.matchingBracket,F,"background"],[i.lineGutter,C,"color"],[i.foldGutter,q,"color"],[i.visibleSpace,q,"color"],[i.accentColor,$,"color"],[i.syntaxMarker,I,"color"],[i.boldText,V,"color"],[i.italicText,H,"color"],[i.quoteText,A,"color"],[i.dividerColor,K,"color"]],z=Array.from(document.querySelectorAll("style")),p=n?s().darkOriginalRules:s().lightOriginalRules;for(const D of z){const x=D.sheet?.cssRules;if(x!==void 0)for(let T=0;T<x.length;++T){const d=x[T],g=d.selectorText??"";g.includes(".cm-focused")&&g.includes(i.selectionBackground)&&(p.selectionBackground??=d.cssText,a?d.cssText=p.selectionBackground:k!==void 0&&d.style.setProperty("background",k,"important")),$!==void 0&&(g===".cm-md-header"||g===".cm-md-header:not(.cm-md-quote)")&&(p.markdownHeader??=d.cssText,a?d.cssText=p.markdownHeader:d.style.removeProperty("color"));for(const[J,P,_]of U)g===J&&(P===void 0?d.style.removeProperty(_):(d.style.setProperty(_,P,"important"),(g===i.matchingBracket||g===i.activeIndicator)&&d.style.setProperty("box-shadow","unset","important")))}}}lt({light:{colors:{allowsFallback:!1}},dark:{colors:{allowsFallback:!1}}});
