"use strict";const J=require("@codemirror/state"),c=require("@lezer/highlight"),f=require("markedit-api"),Q=require("@codemirror/view"),P=require("@codemirror/language"),v=(e,i={})=>e??i,W=v(f.MarkEdit.userSettings),S=L("extension.markeditTheming"),X=b(!1)?v(S.lightTheme):void 0,Y=b(!0)?v(S.darkTheme):void 0;function L(e){return e===void 0?{}:v(W[e])}function N(e){return e.enabledMode??"both"}function b(e,i=N(S)){return["both",e?"dark":"light"].includes(i)}function Z(e,i,a){const r=tt({lhs:a,rhs:e?Y:X});return{extensions:[...e?_(r,{dark:!0}):_(r),i].filter(t=>t!==void 0),colors:r}}function _(e,i){const a={},r=[],o=e.editor,t=e.highlight;o?.textColor&&(a["&"]??={},a["&"].color=o?.textColor,a[".cm-activeLineGutter"]={backgroundColor:o?.textColor}),o?.backgroundColor&&(a["&"]??={},a["&"].backgroundColor=o?.backgroundColor),o?.activeLineBackground&&(a[".cm-activeLine"]={backgroundColor:o?.activeLineBackground}),o?.caretColor&&(a[".cm-content"]={caretColor:o?.caretColor},a[".cm-cursor, .cm-dropCursor"]={borderLeftColor:o?.caretColor}),o?.selectionBackground&&(a["&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection"]={backgroundColor:o?.selectionBackground}),o?.matchingBracketBackground&&(a["&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket"]={backgroundColor:o?.matchingBracketBackground}),o?.gutterText&&(a[".cm-gutters"]??={},a[".cm-gutters"].color=o?.gutterText),o?.gutterBackground&&(a[".cm-gutters"]??={},a[".cm-gutters"].backgroundColor=o?.gutterBackground,a[".cm-gutters"].border="none"),o?.foldPlaceholderText&&(a[".cm-foldPlaceholder"]??={},a[".cm-foldPlaceholder"].color=o?.foldPlaceholderText),o?.foldPlaceholderBackground&&(a[".cm-foldPlaceholder"]??={},a[".cm-foldPlaceholder"].backgroundColor=o?.foldPlaceholderBackground,a[".cm-foldPlaceholder"].border="none"),o?.searchMatchBackground&&(a[".cm-searchMatch"]={backgroundColor:o?.searchMatchBackground}),o?.selectionMatchBackground&&(a[".cm-selectionMatch"]={backgroundColor:o?.selectionMatchBackground}),t?.heading&&r.push({tag:c.tags.heading,color:t?.heading}),t?.bold&&r.push({tag:c.tags.strong,color:t?.bold}),t?.italic&&r.push({tag:c.tags.emphasis,color:t?.italic}),t?.strikethrough&&r.push({tag:c.tags.strikethrough,color:t?.strikethrough}),t?.quote&&r.push({tag:c.tags.quote,color:t?.quote}),t?.link&&r.push({tag:[c.tags.url,c.tags.link],color:t?.link}),t?.divider&&r.push({tag:c.tags.contentSeparator,color:t?.divider}),t?.comment&&r.push({tag:c.tags.comment,color:t?.comment}),t?.meta&&r.push({tag:c.tags.meta,color:t?.meta}),t?.keyword&&r.push({tag:c.tags.keyword,color:t?.keyword}),t?.atom&&r.push({tag:[c.tags.atom,c.tags.bool],color:t?.atom}),t?.literal&&r.push({tag:[c.tags.literal,c.tags.inserted],color:t?.literal}),t?.string&&r.push({tag:[c.tags.string,c.tags.deleted],color:t?.string}),t?.special&&r.push({tag:[c.tags.regexp,c.tags.escape,c.tags.special(c.tags.string)],color:t?.special}),t?.variable&&r.push({tag:c.tags.definition(c.tags.variableName),color:t?.variable}),t?.local&&r.push({tag:c.tags.local(c.tags.variableName),color:t?.local}),t?.type&&r.push({tag:[c.tags.typeName,c.tags.namespace],color:t?.type}),t?.class&&r.push({tag:c.tags.className,color:t?.class}),t?.macro&&r.push({tag:[c.tags.special(c.tags.variableName),c.tags.macroName],color:t?.macro}),t?.property&&r.push({tag:c.tags.definition(c.tags.propertyName),color:t?.property}),t?.label&&r.push({tag:c.tags.labelName,color:t?.label}),t?.operator&&r.push({tag:[c.tags.operator,c.tags.operatorKeyword],color:t?.operator}),t?.constant&&r.push({tag:[c.tags.color,c.tags.constant(c.tags.name),c.tags.standard(c.tags.name)],color:t?.constant}),t?.instruction&&r.push({tag:[c.tags.separator,c.tags.processingInstruction,c.tags.definition(c.tags.name)],color:t?.instruction}),t?.invalid&&r.push({tag:c.tags.invalid,color:t?.invalid});const l=[];return Object.keys(a).length>0&&l.push(Q.EditorView.theme(a,i)),r.length>0&&l.push(P.syntaxHighlighting(P.HighlightStyle.define(r))),l}function tt(e){return{editor:{...e.lhs?.editor,...e.rhs?.editor},highlight:{...e.lhs?.highlight,...e.rhs?.highlight},subtleEmphasis:e.rhs?.subtleEmphasis??e.lhs?.subtleEmphasis}}const n={selectionBackground:".cm-selectionBackground",lineGutter:".cm-lineNumbers > .cm-activeLineGutter",foldGutter:".cm-foldGutter, .cm-foldPlaceholder",visibleSpace:".cm-visibleSpace, .cm-visibleSpace::before, .cm-visibleLineBreak, .cm-visibleLineBreak::before",matchingBracket:".cm-matchingBracket",activeIndicator:".cm-md-activeIndicator",accentColor:".cm-md-header:not(.tok-meta):not(.cm-md-quote), .cm-md-codeInfo",syntaxMarker:".cm-md-header.tok-meta:not(.cm-md-quote), .cm-md-codeMark, .cm-md-linkMark, .cm-md-listMark, .cm-md-quoteMark, .cm-md-bold.tok-meta, .cm-md-italic.tok-meta, .cm-md-strikethrough.tok-meta",boldText:".cm-md-bold:not(.tok-meta)",italicText:".cm-md-italic:not(.tok-meta)",quoteText:".cm-md-quote:not(.cm-md-quoteMark)",dividerColor:".cm-md-horizontalRule"},et=`
.cm-activeLineGutter { background: inherit !important }
.cm-searchMatch.cm-searchMatch-selected { outline: inherit !important }
${n.lineGutter} {}
${n.foldGutter} {}
${n.visibleSpace} {}
${n.matchingBracket} {}
${n.activeIndicator} {}
${n.accentColor} {}
${n.syntaxMarker} {}
${n.boldText} {}
${n.italicText} {}
${n.quoteText} {}
${n.dividerColor} {}
`,O=window,ot=O.__extractStyleRules__??(e=>e.value?.rules),rt=O.__extractHighlightSpecs__??(e=>e.value?.specs);function ct(e){const i=document.createElement("style");return i.textContent=e,document.head.appendChild(i),i}function at(e){if(e.length===0)return[{},[]];const i=B(e);return[Object.fromEntries(i.flatMap(r=>{const o=ot(r)?.join(`
`)??"";return Object.entries(nt(o))})),i.flatMap(r=>rt(r)??[])]}function h(e,i,a){return e.find(r=>!!(r.tag.toString().includes(i.toString())&&r.color!==void 0))?.color??a}function T(e,i,a){for(const[r,o]of Object.entries(e))if(r.includes(i)&&(a===void 0||!r.includes(a))){const t=o.background??o.backgroundColor;if(t!==void 0)return t}}function it(e){const i=e.match(/rgba?\((\d+), (\d+), (\d+)(?:, ([\d.]+))?\)/);if(i===null)return;const[a,r,o]=i.slice(1,4).map(Number);return`rgba(${a}, ${r}, ${o}, 0.6)`}function j(e){const i=o=>o!==null&&typeof o=="object";if(!i(e))return!0;const a=Object.entries(e),r=o=>o!=null;for(const[,o]of a)if(i(o)){if(!j(o))return!1}else if(r(o))return!1;return!0}function B(e){return Array.isArray(e)?e.flatMap(B):"extension"in e?B(e.extension):[e]}function nt(e){const i={},a=new CSSStyleSheet;a.replaceSync(e);for(const r of a.cssRules){const{style:o,selectorText:t}=r,{background:l,backgroundColor:u}=o;i[t]={},l.length>0&&(i[t].background=l),u.length>0&&(i[t].backgroundColor=u)}return i}function st(e){const i=e.options?.settingsKey,a=N(L(i));e.light!==void 0&&b(!1,a)&&(s().customThemes.light=e.light),e.dark!==void 0&&b(!0,a)&&(s().customThemes.dark=e.dark),typeof f.MarkEdit.editorView=="object"&&M(f.MarkEdit.editorView)}const p=window,s=()=>p.__markeditTheming__,R=matchMedia("(prefers-color-scheme: dark)");typeof s()!="object"&&lt();function lt(){p.__markeditTheming__={styleSheet:ct(et),configurator:new J.Compartment,customThemes:{},lightOriginalRules:{},darkOriginalRules:{}},f.MarkEdit.addExtension(s().configurator.of([])),f.MarkEdit.onEditorReady(i=>M(i));const e=()=>setTimeout(()=>M(f.MarkEdit.editorView),15);R.addEventListener("change",e),s().mainThemeName=p.config.theme,Object.defineProperty(p.config,"theme",{get(){return s().mainThemeName},set(i){s().mainThemeName=i,e()}})}function M(e){const i=R.matches,a=i?s().customThemes.dark:s().customThemes.light,{extensions:r,colors:o}=Z(i,a?.extension,a?.colors);e.dispatch({effects:s().configurator.reconfigure(r)});const[t,l]=at(r),u=r.length===0&&j(o);s().styleSheet.disabled=u,dt(e,i,u,t,l,o)}function dt(e,i,a,r,o,t){const l=T(r,".cm-activeLine",".cm-activeLineGutter"),u=T(r,n.selectionBackground),G=T(r,n.matchingBracket),y=getComputedStyle(e.contentDOM).color,q=t.editor?.visibleSpaceColor??it(y),m=t.subtleEmphasis===!0?y:void 0,$=h(o,c.tags.heading,m),I=h(o,c.tags.processingInstruction,m),V=h(o,c.tags.strong,m),H=h(o,c.tags.emphasis,m),A=h(o,c.tags.quote,m),K=h(o,c.tags.contentSeparator,m),U=[[n.activeIndicator,l,"background"],[n.matchingBracket,G,"background"],[n.lineGutter,y,"color"],[n.foldGutter,q,"color"],[n.visibleSpace,q,"color"],[n.accentColor,$,"color"],[n.syntaxMarker,I,"color"],[n.boldText,V,"color"],[n.italicText,H,"color"],[n.quoteText,A,"color"],[n.dividerColor,K,"color"]],z=Array.from(document.querySelectorAll("style")),k=i?s().darkOriginalRules:s().lightOriginalRules;for(const D of z){const C=D.sheet?.cssRules;if(C!==void 0)for(let x=0;x<C.length;++x){const d=C[x],g=d.selectorText??"";g.includes(".cm-focused")&&g.includes(n.selectionBackground)&&(k.selectionBackground??=d.cssText,a?d.cssText=k.selectionBackground:u!==void 0&&d.style.setProperty("background",u,"important")),$!==void 0&&(g===".cm-md-header"||g===".cm-md-header:not(.cm-md-quote)")&&(k.markdownHeader??=d.cssText,a?d.cssText=k.markdownHeader:d.style.removeProperty("color"));for(const[F,w,E]of U)g===F&&(w===void 0?d.style.removeProperty(E):(d.style.setProperty(E,w,"important"),(g===n.matchingBracket||g===n.activeIndicator)&&d.style.setProperty("box-shadow","unset","important")))}}}st({});
